<html><head><base href="https://websim.ai/"><title>Windows XP Simulator</title><style>body{margin:0;padding:0;font-family:'Tahoma',sans-serif;overflow:hidden;user-select:none;}.desktop{width:100vw;height:100vh;position:relative;background-image:url('https://d7hftxdivxxvm.cloudfront.net/?quality=80&resize_to=width&src=https%3A%2F%2Fartsy-media-uploads.s3.amazonaws.com%2F2RNK1P0BYVrSCZEy_Sd1Ew%252F3417757448_4a6bdf36ce_o.jpg&width=910');background-size:cover;background-position:center;transition:background-color 0.3s ease;}.taskbar{position:absolute;bottom:0;left:0;right:0;height:30px;background:linear-gradient(to bottom,#2584ff 0%,#0254cc 100%);display:flex;align-items:center;padding:0 2px;z-index:1000;transition:background 0.3s ease;}.start-button{background:linear-gradient(to bottom,#6cd82e 0%,#4ca916 100%);color:white;font-weight:bold;padding:2px 10px;border-radius:3px;margin-right:10px;cursor:pointer;transition:all 0.2s ease;}.start-button:hover{transform:scale(1.05);}.clock{margin-left:auto;color:white;font-size:11px;padding-right:10px;cursor:pointer;}.icon{position:absolute;display:flex;flex-direction:column;align-items:center;cursor:move;color:white;text-shadow:1px 1px 2px black;transition:transform 0.2s ease;}.icon:hover{transform:scale(1.1);}.icon img{width:32px;height:32px;margin-bottom:5px;}.icon-label{font-size:12px;text-align:center;}.window{position:absolute;background:#ECE9D8;border:1px solid #0054E3;box-shadow:2px 2px 5px rgba(0,0,0,0.2);resize:both;overflow:auto;min-width:200px;min-height:150px;transition:all 0.3s ease;animation:windowFadeIn 0.3s ease;}.window-header{background:linear-gradient(to right,#0058E6,#3986FF);color:white;padding:5px;font-weight:bold;display:flex;justify-content:space-between;align-items:center;cursor:move;transition:background 0.2s ease;}.window-header:hover{background:linear-gradient(to right,#0068F6,#4996FF);}.window-content{padding:10px;height:calc(100% - 40px);overflow:auto;}.close-btn,.minimize-btn,.maximize-btn{cursor:pointer;margin-left:5px;padding:2px 6px;border-radius:2px;transition:background 0.2s ease;}.close-btn:hover{background:rgba(255,255,255,0.2);}.minimize-btn:hover{background:rgba(255,255,255,0.2);}.maximize-btn:hover{background:rgba(255,255,255,0.2);}.folder-view{display:flex;flex-wrap:wrap;gap:30px;padding:15px;}.folder-icon{display:flex;flex-direction:column;align-items:center;width:80px;cursor:pointer;transition:transform 0.2s ease;}.folder-icon:hover{transform:scale(1.1);}.folder-icon img{width:48px;height:48px;margin-bottom:5px;}.folder-label{font-size:11px;text-align:center;color:black;} .folder-window{display:flex;height:100%;background:#fff;} .folder-sidebar{width:150px;background:linear-gradient(to bottom,#dbe9f9,#c2d8f0);padding:10px;font-size:12px;color:#000;} .folder-content{flex:1;overflow:auto;}.my-computer-content{display:flex;flex-wrap:wrap;gap:20px;padding:10px;}.drive-icon{display:flex;flex-direction:column;align-items:center;width:80px;cursor:pointer;transition:transform 0.2s ease;}.drive-icon:hover{transform:scale(1.1);}.drive-icon img{width:32px;height:32px;margin-bottom:5px;}.drive-label{font-size:11px;text-align:center;color:black;}.document-content{padding:10px;font-size:12px;}.psp-emu-window{width:100%;height:100%;border:none;}.maximized{position:fixed !important;top:0 !important;left:0 !important;width:100vw !important;height:calc(100vh - 30px) !important;z-index:999;}.psp-emu-container{position:relative;width:100%;height:100%;}.psp-emu-overlay{position:absolute;top:0;left:0;right:0;height:38px;background:#ECE9D8;z-index:1;}.start-menu{position:absolute;bottom:30px;left:0;width:380px;background:#D5E3FC;border:1px solid #0054E3;box-shadow:2px 2px 5px rgba(0,0,0,0.2);display:none;z-index:1001;animation:slideUp 0.2s ease;}.start-menu-header{background:linear-gradient(to right,#1758CA,#7DA3E8);color:white;padding:5px;font-weight:bold;font-size:14px;display:flex;align-items:center;}.start-menu-header img{width:24px;height:24px;margin-right:5px;}.start-menu-left{width:200px;background:#D5E3FC;padding:5px;}.start-menu-right{width:180px;background:#7DA3E8;padding:5px;}.start-menu-item{padding:5px;cursor:pointer;display:flex;align-items:center;transition:background 0.2s ease;}.start-menu-item:hover{background:#316AC5;color:white;}.start-menu-item img{width:24px;height:24px;margin-right:5px;}.start-menu-separator{height:1px;background:#7DA3E8;margin:5px 0;}.minimized{display:none;animation:windowMinimize 0.3s ease;}.taskbar-item{background:linear-gradient(to bottom,#f0f0f0,#e0e0e0);border:1px solid #999;padding:2px 5px;margin-right:2px;cursor:pointer;max-width:150px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-size:11px;height:22px;line-height:22px;transition:all 0.2s ease;}.taskbar-item:hover{background:linear-gradient(to bottom,#fff,#f0f0f0);}.chrome-window{width:100%;height:calc(100% - 10px);border:none;}#taskbar-items{display:flex;flex-grow:1;overflow-x:hidden;}@keyframes windowFadeIn{from{opacity:0;transform:scale(0.9);}to{opacity:1;transform:scale(1);}}@keyframes slideUp{from{transform:translateY(10px);opacity:0;}to{transform:translateY(0);opacity:1;}}@keyframes windowMinimize{to{transform:scale(0.1);opacity:0;}}</style><style>.add-app-button{background:linear-gradient(to bottom,#ffa64d 0%,#d97a00 100%);color:white;font-weight:bold;padding:2px 10px;border-radius:3px;margin-right:10px;cursor:pointer;}</style><style>.context-menu{position:fixed;display:none;background:#f0f0f0;border:1px solid #666;z-index:1000;} .context-menu ul{list-style:none;margin:0;padding:5px 0;} .context-menu li{padding:4px 20px;white-space:nowrap;cursor:pointer;} .context-menu li:hover{background:#0a246a;color:#fff;} .context-menu.top{z-index:20000;} .open-menu-button{position:fixed;top:80px;right:20px;z-index:10001;cursor:move;}</style><link rel='stylesheet' href='about-modal.css'></head><body><div id="desktop" class="desktop"><div class="icon" style="top:20px;left:20px;" data-app="my-computer" title="My Computer"><img src="https://i.imgur.com/Rc7JRUI.png" alt="My Computer"><div class="icon-label">My Computer</div></div><div class="icon" style="top:100px;left:20px;" data-app="recycle-bin" title="Recycle Bin"><img src="https://i.imgur.com/AVKS9Rm.png" alt="Recycle Bin"><div class="icon-label">Recycle Bin</div></div><div class="icon" style="top:180px;left:20px;" data-app="my-documents" title="My Documents"><img src="https://cdn-icons-png.flaticon.com/512/3330/3330314.png" alt="My Documents"><div class="icon-label">My Documents</div></div><div class="icon" style="top:20px;left:120px;" data-app="notepad" title="Notepad - Text Editor"><img src="https://cdn-icons-png.flaticon.com/512/2991/2991112.png" alt="Notepad"><div class="icon-label">Notepad</div></div><div class="icon" style="top:100px;left:120px;" data-app="calculator" title="Calculator"><img src="https://cdn-icons-png.flaticon.com/512/2698/2698011.png" alt="Calculator"><div class="icon-label">Calculator</div></div><div class="icon" style="top:180px;left:120px;" data-app="paint" title="Paint - Drawing Application"><img src="https://cdn-icons-png.flaticon.com/512/2965/2965230.png" alt="Paint"><div class="icon-label">Paint</div></div><div class="icon" style="top:20px;left:220px;" data-app="minesweeper" title="Minesweeper Game"><img src="https://cdn-icons-png.flaticon.com/512/2991/2991423.png" alt="Minesweeper"><div class="icon-label">Minesweeper</div></div><div class="icon" style="top:100px;left:220px;" data-app="solitaire" title="Solitaire Card Game"><img src="https://cdn-icons-png.flaticon.com/512/2991/2991495.png" alt="Solitaire"><div class="icon-label">Solitaire</div></div><div class="icon" style="top:180px;left:220px;" data-app="media-player" title="Windows Media Player"><img src="https://cdn-icons-png.flaticon.com/512/2965/2965307.png" alt="Media Player"><div class="icon-label">Media Player</div></div><div class="icon" style="top:260px;left:20px;" data-app="psp-emu" title="PSP Emulator"><img src="https://cdn-icons-png.flaticon.com/512/2949/2949874.png" alt="PSP EMU"><div class="icon-label">PSP EMU</div></div><div class="icon" style="top:340px;left:20px;" data-app="google-chrome" title="Google Chrome Browser"><img src="https://upload.wikimedia.org/wikipedia/commons/e/e1/Google_Chrome_icon_%28February_2022%29.svg" alt="Google Chrome"><div class="icon-label">Google Chrome</div></div><div class="icon" style="top:20px;left:320px;" data-app="snake" title="Snake Game"><img src="https://cdn-icons-png.flaticon.com/512/2991/2991206.png" alt="Snake"><div class="icon-label">Snake</div></div><div class="icon" style="top:100px;left:320px;" data-app="tictactoe" title="Tic-Tac-Toe"><img src="https://cdn-icons-png.flaticon.com/512/566/566294.png" alt="TicTacToe"><div class="icon-label">Tic-Tac-Toe</div></div><div class="icon" style="top:180px;left:320px;" data-app="task-manager" title="Task Manager"><img src="https://cdn-icons-png.flaticon.com/512/3079/3079404.png" alt="Task Manager"><div class="icon-label">Task Manager</div></div><div class="icon" style="top:260px;left:320px;" data-app="sticky-notes" title="Sticky Notes"><img src="https://cdn-icons-png.flaticon.com/512/2965/2965306.png" alt="Sticky Notes"><div class="icon-label">Sticky Notes</div></div><div class="icon" style="top:340px;left:320px;" data-app="calendar" title="Calendar"><img src="https://cdn-icons-png.flaticon.com/512/2693/2693507.png" alt="Calendar"><div class="icon-label">Calendar</div></div><div class="icon" style="top:420px;left:20px;" data-app="photo-viewer" title="Photo Viewer"><img src="https://cdn-icons-png.flaticon.com/512/3342/3342137.png" alt="Photo Viewer"><div class="icon-label">Photo Viewer</div></div><div class="taskbar"><div class="start-button">Start</div><div class="add-app-button">Add App</div><div id="taskbar-items"></div><div class="clock">12:00</div></div><div class="start-menu"><div class="start-menu-header"><img src="https://i.imgur.com/Rc7JRUI.png" alt="User Icon">User</div><div style="display:flex;"><div class="start-menu-left"><div class="start-menu-item" data-app="internet-explorer"><img src="https://i.imgur.com/s9HhTqB.png" alt="Internet Explorer">Internet Explorer</div><div class="start-menu-item" data-app="outlook-express"><img src="https://i.imgur.com/iJrBwfj.png" alt="Outlook Express">Outlook Express</div><div class="start-menu-separator"></div><div class="start-menu-item" data-app="my-computer"><img src="https://i.imgur.com/Rc7JRUI.png" alt="My Computer">My Computer</div><div class="start-menu-item" data-app="my-documents"><img src="https://cdn-icons-png.flaticon.com/512/3330/3330314.png" alt="My Documents">My Documents</div><div class="start-menu-item" data-app="control-panel"><img src="https://i.imgur.com/Mrqm7i6.png" alt="Control Panel">Control Panel</div><div class="start-menu-separator"></div><div class="start-menu-item" data-app="help"><img src="https://i.imgur.com/OQw2CwX.png" alt="Help and Support">Help and Support</div><div class="start-menu-item" data-app="search"><img src="https://i.imgur.com/0X6zIZd.png" alt="Search">Search</div><div class="start-menu-item" data-app="run"><img src="https://i.imgur.com/qgxGYQM.png" alt="Run">Run...</div></div><div class="start-menu-right"><div class="start-menu-item" data-app="notepad"><img src="https://cdn-icons-png.flaticon.com/512/2991/2991112.png" alt="Notepad">Notepad</div><div class="start-menu-item" data-app="calculator"><img src="https://cdn-icons-png.flaticon.com/512/2698/2698011.png" alt="Calculator">Calculator</div><div class="start-menu-item" data-app="paint"><img src="https://cdn-icons-png.flaticon.com/512/2965/2965230.png" alt="Paint">Paint</div><div class="start-menu-separator"></div><div class="start-menu-item" data-app="minesweeper"><img src="https://cdn-icons-png.flaticon.com/512/2991/2991423.png" alt="Minesweeper">Minesweeper</div><div class="start-menu-item" data-app="solitaire"><img src="https://cdn-icons-png.flaticon.com/512/2991/2991495.png" alt="Solitaire">Solitaire</div><div class="start-menu-item" data-app="snake"><img src="https://cdn-icons-png.flaticon.com/512/2991/2991206.png" alt="Snake">Snake</div><div class="start-menu-item" data-app="tictactoe"><img src="https://cdn-icons-png.flaticon.com/512/566/566294.png" alt="TicTacToe">Tic-Tac-Toe</div><div class="start-menu-separator"></div><div class="start-menu-item" data-app="task-manager"><img src="https://cdn-icons-png.flaticon.com/512/3079/3079404.png" alt="Task Manager">Task Manager</div><div class="start-menu-item" data-app="sticky-notes"><img src="https://cdn-icons-png.flaticon.com/512/2965/2965306.png" alt="Sticky Notes">Sticky Notes</div><div class="start-menu-item" data-app="calendar"><img src="https://cdn-icons-png.flaticon.com/512/2693/2693507.png" alt="Calendar">Calendar</div><div class="start-menu-item" data-app="photo-viewer"><img src="https://cdn-icons-png.flaticon.com/512/3342/3342137.png" alt="Photo Viewer">Photo Viewer</div><div class="start-menu-item" data-app="media-player"><img src="https://cdn-icons-png.flaticon.com/512/2965/2965307.png" alt="Media Player">Media Player</div><div class="start-menu-separator"></div><div class="start-menu-item" data-app="psp-emu"><img src="https://cdn-icons-png.flaticon.com/512/2949/2949874.png" alt="PSP EMU">PSP EMU</div><div class="start-menu-item" data-app="google-chrome"><img src="https://upload.wikimedia.org/wikipedia/commons/e/e1/Google_Chrome_icon_%28February_2022%29.svg" alt="Google Chrome">Google Chrome</div><div class="start-menu-separator"></div><div class="start-menu-item" data-app="log-off"><img src="https://i.imgur.com/BpMCFCX.png" alt="Log Off">Log Off</div><div class="start-menu-item" data-app="turn-off"><img src="https://i.imgur.com/TftAWxI.png" alt="Turn Off Computer">Turn Off Computer</div></div></div></div></div><script>const apps={
  'notepad': {
    title: 'Notepad',
    content: `
      <div style="display:flex;flex-direction:column;height:100%;background:#fff;">
        <div style="background:#ECE9D8;padding:2px;border-bottom:1px solid #999;display:flex;gap:10px;align-items:center;flex-wrap:wrap;">
          <button onclick="document.querySelector('.notepad-text').value=''" style="padding:2px 8px;">New</button>
          <button onclick="saveNotepad()" style="padding:2px 8px;">Save</button>
          <button onclick="loadNotepad()" style="padding:2px 8px;">Load</button>
          <div style="border-left:1px solid #999;height:20px;"></div>
          <input type="text" id="notepad-search" placeholder="Search..." style="padding:2px 6px;width:120px;border:1px solid #999;">
          <button onclick="searchNotepad()" style="padding:2px 8px;">Find</button>
          <div style="border-left:1px solid #999;height:20px;"></div>
          <button onclick="countWords()" style="padding:2px 8px;">Word Count</button>
          <span id="notepad-stats" style="font-size:11px;color:#666;"></span>
        </div>
        <textarea class="notepad-text" oninput="updateNotepadStats()" style="flex:1;border:none;padding:10px;font-family:Consolas,monospace;font-size:13px;resize:none;outline:none;"></textarea>
      </div>
    `
  },
  'calculator': {
    title: 'Calculator',
    content: `
      <div style="background:#ECE9D8;padding:10px;width:220px;">
        <div style="text-align:left;margin-bottom:5px;font-size:12px;color:#666;">Memory: <span id="calc-memory">0</span></div>
        <input type="text" id="calc-display" readonly style="width:100%;height:40px;font-size:20px;text-align:right;margin-bottom:10px;border:2px inset;background:#fff;padding:5px;box-sizing:border-box;">
        <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:4px;margin-bottom:4px;">
          <button onclick="calcMemoryAdd()" style="padding:8px;font-size:14px;background:#d4d0c8;">M+</button>
          <button onclick="calcMemorySub()" style="padding:8px;font-size:14px;background:#d4d0c8;">M-</button>
          <button onclick="calcMemoryRecall()" style="padding:8px;font-size:14px;background:#d4d0c8;">MR</button>
          <button onclick="calcMemoryClear()" style="padding:8px;font-size:14px;background:#d4d0c8;">MC</button>
        </div>
        <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:4px;">
          <button onclick="calcClick('7')" style="padding:10px;font-size:16px;">7</button>
          <button onclick="calcClick('8')" style="padding:10px;font-size:16px;">8</button>
          <button onclick="calcClick('9')" style="padding:10px;font-size:16px;">9</button>
          <button onclick="calcClick('/')" style="padding:10px;font-size:16px;">/</button>
          <button onclick="calcClick('4')" style="padding:10px;font-size:16px;">4</button>
          <button onclick="calcClick('5')" style="padding:10px;font-size:16px;">5</button>
          <button onclick="calcClick('6')" style="padding:10px;font-size:16px;">6</button>
          <button onclick="calcClick('*')" style="padding:10px;font-size:16px;">*</button>
          <button onclick="calcClick('1')" style="padding:10px;font-size:16px;">1</button>
          <button onclick="calcClick('2')" style="padding:10px;font-size:16px;">2</button>
          <button onclick="calcClick('3')" style="padding:10px;font-size:16px;">3</button>
          <button onclick="calcClick('-')" style="padding:10px;font-size:16px;">-</button>
          <button onclick="calcClick('0')" style="padding:10px;font-size:16px;">0</button>
          <button onclick="calcClick('.')" style="padding:10px;font-size:16px;">.</button>
          <button onclick="calcEquals()" style="padding:10px;font-size:16px;">=</button>
          <button onclick="calcClick('+')" style="padding:10px;font-size:16px;">+</button>
          <button onclick="calcClear()" style="padding:10px;font-size:16px;grid-column:span 2;">C</button>
          <button onclick="calcBackspace()" style="padding:10px;font-size:16px;grid-column:span 2;">‚å´</button>
        </div>
      </div>
    `
  },
  'paint': {
    title: 'Paint',
    content: `
      <div style="display:flex;flex-direction:column;height:100%;background:#ECE9D8;">
        <div style="background:#ECE9D8;padding:5px;border-bottom:1px solid #999;display:flex;gap:5px;align-items:center;flex-wrap:wrap;">
          <div style="display:flex;gap:3px;border-right:1px solid #999;padding-right:5px;">
            <button id="tool-brush" onclick="setPaintTool('brush')" style="padding:4px 8px;background:#fff;border:2px inset #999;">üñåÔ∏è</button>
            <button id="tool-rectangle" onclick="setPaintTool('rectangle')" style="padding:4px 8px;border:2px outset #999;">‚ñ≠</button>
            <button id="tool-circle" onclick="setPaintTool('circle')" style="padding:4px 8px;border:2px outset #999;">‚≠ï</button>
            <button id="tool-eraser" onclick="setPaintTool('eraser')" style="padding:4px 8px;border:2px outset #999;">üßπ</button>
          </div>
          <input type="color" id="paint-color" value="#000000" style="width:40px;height:30px;">
          <label>Size:</label>
          <input type="range" id="paint-size" min="1" max="20" value="3" style="width:100px;">
          <button onclick="clearCanvas()" style="padding:4px 10px;">Clear</button>
          <button onclick="fillCanvas()" style="padding:4px 10px;">Fill</button>
        </div>
        <canvas id="paint-canvas" style="flex:1;background:#fff;cursor:crosshair;"></canvas>
      </div>
    `
  },
  'minesweeper': {
    title: 'Minesweeper',
    content: `
      <div style="background:#ECE9D8;padding:10px;">
        <div style="text-align:center;margin-bottom:10px;">
          <button onclick="initMinesweeper()" style="padding:5px 15px;font-size:16px;">üôÇ New Game</button>
          <div style="margin-top:5px;">Mines: <span id="mines-count">10</span></div>
        </div>
        <div id="minesweeper-grid" style="display:inline-block;background:#999;border:3px outset #ECE9D8;"></div>
      </div>
    `
  },
  'solitaire': {
    title: 'Solitaire',
    content: `
      <div style="background:#0a8000;padding:20px;text-align:center;height:100%;">
        <h2 style="color:#fff;margin-bottom:20px;">üÉè Solitaire</h2>
        <button onclick="initSolitaire()" style="padding:10px 20px;font-size:16px;">New Game</button>
        <div id="solitaire-game" style="margin-top:20px;"></div>
      </div>
    `
  },
  'snake': {
    title: 'Snake Game',
    content: `
      <div style="background:#000;padding:20px;text-align:center;height:100%;">
        <div style="color:#0f0;margin-bottom:10px;">Score: <span id="snake-score">0</span> | High: <span id="snake-high">0</span></div>
        <canvas id="snake-canvas" width="400" height="400" style="border:2px solid #0f0;background:#000;"></canvas>
        <div style="margin-top:10px;">
          <button onclick="startSnake()" style="padding:8px 20px;margin:5px;">Start</button>
          <button onclick="pauseSnake()" style="padding:8px 20px;margin:5px;">Pause</button>
        </div>
        <div style="color:#0f0;margin-top:10px;font-size:12px;">Use Arrow Keys to move</div>
      </div>
    `
  },
  'tictactoe': {
    title: 'Tic-Tac-Toe',
    content: `
      <div style="background:#ECE9D8;padding:20px;text-align:center;">
        <h3>Tic-Tac-Toe</h3>
        <div style="margin:10px 0;">Player: <span id="ttt-player">X</span></div>
        <div id="ttt-board" style="display:inline-grid;grid-template-columns:repeat(3,80px);gap:5px;margin:10px;"></div>
        <button onclick="resetTicTacToe()" style="padding:8px 20px;margin-top:10px;">New Game</button>
        <div id="ttt-status" style="margin-top:10px;font-weight:bold;"></div>
      </div>
    `
  },
  'task-manager': {
    title: 'Task Manager',
    content: `
      <div style="background:#ECE9D8;padding:10px;height:100%;">
        <div style="background:#fff;border:1px solid #999;padding:10px;height:calc(100% - 60px);overflow:auto;">
          <table style="width:100%;border-collapse:collapse;" id="task-list">
            <thead>
              <tr style="background:#ddd;text-align:left;">
                <th style="padding:5px;border:1px solid #999;">Application</th>
                <th style="padding:5px;border:1px solid #999;">Status</th>
                <th style="padding:5px;border:1px solid #999;">Action</th>
              </tr>
            </thead>
            <tbody id="task-tbody"></tbody>
          </table>
        </div>
        <div style="margin-top:10px;">
          <button onclick="refreshTaskManager()" style="padding:5px 15px;">Refresh</button>
          <button onclick="closeAllWindows()" style="padding:5px 15px;margin-left:5px;">Close All</button>
        </div>
      </div>
    `
  },
  'sticky-notes': {
    title: 'Sticky Notes',
    content: `
      <div style="background:#fff3cd;padding:10px;height:100%;font-family:Comic Sans MS,cursive;">
        <textarea id="sticky-text" style="width:100%;height:calc(100% - 40px);border:none;background:transparent;resize:none;font-size:14px;font-family:inherit;" placeholder="Type your note here..."></textarea>
        <div style="margin-top:5px;">
          <button onclick="saveStickyNote()" style="padding:4px 10px;">Save</button>
          <button onclick="loadStickyNote()" style="padding:4px 10px;">Load</button>
          <button onclick="clearStickyNote()" style="padding:4px 10px;">Clear</button>
        </div>
      </div>
    `
  },
  'calendar': {
    title: 'Calendar',
    content: `
      <div style="background:#ECE9D8;padding:15px;text-align:center;">
        <div style="margin-bottom:10px;display:flex;justify-content:space-between;align-items:center;">
          <button onclick="calendarPrevMonth()" style="padding:5px 10px;">‚óÄ</button>
          <h3 id="calendar-month" style="margin:0;"></h3>
          <button onclick="calendarNextMonth()" style="padding:5px 10px;">‚ñ∂</button>
        </div>
        <div id="calendar-grid" style="display:grid;grid-template-columns:repeat(7,40px);gap:2px;margin:10px auto;width:fit-content;"></div>
        <button onclick="calendarToday()" style="padding:5px 15px;margin-top:10px;">Today</button>
      </div>
    `
  },
  'photo-viewer': {
    title: 'Photo Viewer',
    content: `
      <div style="background:#2c2c2c;padding:10px;text-align:center;height:100%;display:flex;flex-direction:column;">
        <div style="margin-bottom:10px;">
          <input type="text" id="photo-url" placeholder="Enter image URL" style="width:70%;padding:5px;">
          <button onclick="loadPhoto()" style="padding:5px 15px;margin-left:5px;">Load</button>
        </div>
        <div style="flex:1;overflow:auto;display:flex;align-items:center;justify-content:center;" id="photo-container">
          <div style="color:#999;">Enter an image URL above to view</div>
        </div>
      </div>
    `
  },
  'media-player': {
    title: 'Windows Media Player',
    content: `
      <div style="background:linear-gradient(to bottom,#0c3d6e,#000);padding:15px;color:#fff;height:100%;">
        <h3 style="text-align:center;margin-bottom:15px;">üéµ Media Player</h3>
        <div style="background:#000;padding:10px;border-radius:5px;margin-bottom:10px;">
          <input type="text" id="media-url" placeholder="Enter YouTube/Media URL" style="width:100%;padding:8px;box-sizing:border-box;margin-bottom:5px;">
          <button onclick="loadMedia()" style="padding:6px 15px;">Load</button>
        </div>
        <div id="media-container" style="background:#000;min-height:200px;display:flex;align-items:center;justify-content:center;color:#666;">
          No media loaded
        </div>
        <div style="text-align:center;margin-top:10px;">
          <button onclick="alert('Play')" style="padding:8px 15px;margin:2px;">‚ñ∂Ô∏è</button>
          <button onclick="alert('Pause')" style="padding:8px 15px;margin:2px;">‚è∏Ô∏è</button>
          <button onclick="alert('Stop')" style="padding:8px 15px;margin:2px;">‚èπÔ∏è</button>
        </div>
      </div>
    `
  },
  'my-computer': {
    title: 'My Computer',
    content: `
      <div class="folder-window">
  <div class="folder-sidebar">System Tasks</div>
  <div class="folder-content">
    <div class="my-computer-content">
        <div class="drive-icon">
          <img src="https://i.imgur.com/Q3SMT9S.png" alt="Local Disk (C:)">
          <div class="drive-label">Local Disk (C:)</div>
        </div>
        <div class="drive-icon">
          <img src="https://i.imgur.com/Q3SMT9S.png" alt="Local Disk (D:)">
          <div class="drive-label">Local Disk (D:)</div>
        </div>
        <div class="drive-icon">
          <img src="https://i.imgur.com/vGZOKOW.png" alt="CD Drive (E:)">
          <div class="drive-label">CD Drive (E:)</div>
        </div>
      </div>
    </div>
  </div>
</div>
    `
  },
  'recycle-bin': {
    title: 'Recycle Bin',
    content: `
      <div class="folder-window">
  <div class="folder-sidebar">Recycle Bin Tasks</div>
  <div class="folder-content">
    <div class="folder-view">
        <div class="folder-icon">
          <img src="https://i.imgur.com/AVKS9Rm.png" alt="Empty Recycle Bin">
          <div class="folder-label">Empty Recycle Bin</div>
        </div>
      </div>
    </div>
  </div>
</div>
    `
  },
  'my-documents': {
    title: 'My Documents',
    content: `
      <div class="folder-window">
  <div class="folder-sidebar">My Documents Tasks</div>
  <div class="folder-content">
    <div class="folder-view">
        <div class="folder-icon">
          <img src="https://cdn-icons-png.flaticon.com/512/3330/3330314.png" alt="New Text Document">
          <div class="folder-label">New Text Document</div>
        </div>
        <div class="folder-icon">
          <img src="https://cdn-icons-png.flaticon.com/512/3330/3330314.png" alt="Resume">
          <div class="folder-label">Resume.doc</div>
        </div>
      </div>
    </div>
  </div>
</div>
    `
  },
  'psp-emu': {
    title: 'PSP EMU',
    content: `
      <div class="psp-emu-container">
        <div class="psp-emu-overlay"></div>
        <iframe class="psp-emu-window" src="https://websim.ai/c/BZhZd0JIqanPgCu5m"></iframe>
      </div>
    `
  },
  'google-chrome': {
    title: 'Google Chrome',
    content: `
      <iframe class="chrome-window" src="https://www.google.com/webhp?igu=1"></iframe>
    `
  },
  'internet-explorer': {
    title: 'Internet Explorer',
    content: `
      <div style="display:flex;flex-direction:column;height:100%;background:#ECE9D8;">
        <div style="background:#ECE9D8;padding:5px;border-bottom:1px solid #999;display:flex;gap:5px;align-items:center;">
          <button onclick="ieNavigate(-1)" style="padding:4px 10px;">‚Üê</button>
          <button onclick="ieNavigate(1)" style="padding:4px 10px;">‚Üí</button>
          <button onclick="ieRefresh()" style="padding:4px 10px;">‚ü≥</button>
          <button onclick="ieHome()" style="padding:4px 10px;">üè†</button>
          <input type="text" id="ie-url" placeholder="Enter URL..." value="https://www.bing.com" style="flex:1;padding:4px 8px;border:1px solid #999;">
          <button onclick="ieGo()" style="padding:4px 12px;">Go</button>
        </div>
        <iframe id="ie-frame" style="flex:1;border:none;background:#fff;"></iframe>
      </div>
    `
  },
  'outlook-express': {
    title: 'Outlook Express',
    content: `
      <div style="display:flex;height:100%;background:#fff;">
        <div style="width:150px;background:#ECE9D8;border-right:1px solid #999;padding:10px;">
          <h4 style="margin:0 0 10px 0;">Folders</h4>
          <div onclick="showEmailFolder('inbox')" style="padding:5px;cursor:pointer;background:#fff;margin-bottom:2px;">üì• Inbox (3)</div>
          <div onclick="showEmailFolder('sent')" style="padding:5px;cursor:pointer;">üì§ Sent Items</div>
          <div onclick="showEmailFolder('drafts')" style="padding:5px;cursor:pointer;">üìù Drafts</div>
          <div onclick="showEmailFolder('trash')" style="padding:5px;cursor:pointer;">üóëÔ∏è Deleted</div>
        </div>
        <div style="flex:1;display:flex;flex-direction:column;">
          <div style="background:#ECE9D8;padding:5px;border-bottom:1px solid #999;">
            <button onclick="composeEmail()" style="padding:4px 12px;">üìß New Email</button>
            <button onclick="refreshEmails()" style="padding:4px 12px;margin-left:5px;">‚ü≥ Refresh</button>
          </div>
          <div id="email-list" style="flex:1;overflow:auto;padding:10px;">
            <div style="border-bottom:1px solid #ccc;padding:10px;cursor:pointer;background:#e8f4ff;">
              <strong>Welcome to Outlook Express!</strong><br>
              <small>From: Microsoft | Today 9:00 AM</small><br>
              <span style="color:#666;">Your email client is ready to use...</span>
            </div>
            <div style="border-bottom:1px solid #ccc;padding:10px;cursor:pointer;">
              <strong>Windows XP Update</strong><br>
              <small>From: System | Yesterday</small><br>
              <span style="color:#666;">Important security updates available...</span>
            </div>
            <div style="border-bottom:1px solid #ccc;padding:10px;cursor:pointer;">
              <strong>Reminder: Check your settings</strong><br>
              <small>From: Admin | 2 days ago</small><br>
              <span style="color:#666;">Please review your account settings...</span>
            </div>
          </div>
        </div>
      </div>
    `
  },
  'control-panel': {
    title: 'Control Panel',
    content: `
      <div style="padding:20px;background:#fff;height:100%;overflow:auto;">
        <h2 style="margin-top:0;">Control Panel</h2>
        <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:15px;">
          <div style="border:1px solid #999;padding:15px;background:#f0f0f0;cursor:pointer;" onclick="showThemeSettings()">
            <h3 style="margin:0 0 10px 0;">üé® Appearance and Themes</h3>
            <p style="margin:0;font-size:12px;">Change desktop theme, wallpaper, and colors</p>
          </div>
          <div style="border:1px solid #999;padding:15px;background:#f0f0f0;cursor:pointer;" onclick="showDisplaySettings()">
            <h3 style="margin:0 0 10px 0;">üñ•Ô∏è Display Settings</h3>
            <p style="margin:0;font-size:12px;">Adjust screen resolution and window size</p>
          </div>
          <div style="border:1px solid #999;padding:15px;background:#f0f0f0;cursor:pointer;" onclick="showSoundSettings()">
            <h3 style="margin:0 0 10px 0;">üîä Sounds and Audio</h3>
            <p style="margin:0;font-size:12px;">Configure sound effects and volume</p>
          </div>
          <div style="border:1px solid #999;padding:15px;background:#f0f0f0;cursor:pointer;" onclick="showSystemInfo()">
            <h3 style="margin:0 0 10px 0;">‚ÑπÔ∏è System Information</h3>
            <p style="margin:0;font-size:12px;">View system details and performance</p>
          </div>
          <div style="border:1px solid #999;padding:15px;background:#f0f0f0;cursor:pointer;" onclick="showStorageSettings()">
            <h3 style="margin:0 0 10px 0;">üíæ Storage Management</h3>
            <p style="margin:0;font-size:12px;">Manage disk space and localStorage</p>
          </div>
          <div style="border:1px solid #999;padding:15px;background:#f0f0f0;cursor:pointer;" onclick="showClockSettings()">
            <h3 style="margin:0 0 10px 0;">üïê Date and Time</h3>
            <p style="margin:0;font-size:12px;">Toggle between 12/24 hour clock format</p>
          </div>
        </div>
      </div>
    `
  },
  'help': {
    title: 'Help and Support',
    content: `
      <div style="padding: 20px; text-align: center;">
        <h2>Help and Support</h2>
        <p>How can we assist you today?</p>
      </div>
    `
  },
  'search': {
    title: 'Search',
    content: `
      <div style="padding: 20px; text-align: center;">
        <h2>Search</h2>
        <p>Find files and folders</p>
      </div>
    `
  },
  'run': {
    title: 'Run',
    content: `
      <div style="padding: 20px; text-align: center;">
        <h2>Run</h2>
        <input type="text" placeholder="Type the name of a program, folder, document, or Internet resource">
      </div>
    `
  },
  'email': {
    title: 'E-mail',
    content: `
      <div style="padding: 20px; text-align: center;">
        <h2>E-mail</h2>
        <p>Compose a new message</p>
      </div>
    `
  }
};

let windowZIndex = 1000;
let defaultWindowWidth = 800;
let defaultWindowHeight = 600;
let activeWindow = null;
let use24Hour = true;

function createWindow(app, width = defaultWindowWidth, height = defaultWindowHeight){
  const {title,content}=apps[app];
  const window=document.createElement('div');
  window.className='window';
  window.style.top='50px';
  window.style.left='50px';
  window.style.width=width+'px';
  window.style.height=height+'px';
  window.style.zIndex = ++windowZIndex;
  window.innerHTML=`
    <div class="window-header">
      <span>${title}</span>
      <div>
        <span class="minimize-btn">_</span>
        <span class="maximize-btn">‚ñ°</span>
        <span class="close-btn">‚úñ</span>
      </div>
    </div>
    <div class="window-content">${content}</div>
  `;
  document.getElementById('desktop').appendChild(window);
activeWindow = window;
  window.addEventListener("mousedown", ()=>{ activeWindow = window; });
  playOpenSound();

  if(app === 'psp-emu' || app === 'google-chrome'){
    window.classList.add('maximized');
  }

  let isDragging=false;
  let startX,startY,startLeft,startTop;

  const header = window.querySelector('.window-header');

  // Double-click to maximize
  header.addEventListener('dblclick', function(){
    if(app !== 'psp-emu' && app !== 'google-chrome'){
      window.classList.toggle('maximized');
    }
  });

  header.addEventListener('mousedown',function(e){
    if(app !== 'psp-emu' && app !== 'google-chrome'){
      isDragging=true;
      startX=e.clientX;
      startY=e.clientY;
      startLeft=parseInt(window.style.left)||0;
      startTop=parseInt(window.style.top)||0;
      window.style.zIndex = ++windowZIndex;
    }
  });

  document.addEventListener('mousemove',function(e){
    if(!isDragging)return;
    const newLeft=startLeft+e.clientX-startX;
    const newTop=startTop+e.clientY-startY;
    window.style.left=newLeft+'px';
    window.style.top=newTop+'px';
  });

  document.addEventListener('mouseup',function(){
    isDragging=false;
  });

  window.querySelector('.close-btn').addEventListener('click',function(){
    playCloseSound();
    window.remove();
    removeTaskbarItem(window);
  });

  window.querySelector('.minimize-btn').addEventListener('click',function(){
    window.classList.add('minimized');
    updateTaskbarItem(window);
  });

  window.querySelector('.maximize-btn').addEventListener('click',function(){
    window.classList.toggle('maximized');
  });

  addTaskbarItem(window);

  return window;
}

function addTaskbarItem(window){
  const taskbarItems = document.getElementById('taskbar-items');
  const item = document.createElement('div');
  item.className = 'taskbar-item';
  item.textContent = window.querySelector('.window-header span').textContent;
  item.addEventListener('click', function(){
    if(window.classList.contains('minimized')){
      window.classList.remove('minimized');
      window.style.zIndex = ++windowZIndex;
    } else {
      window.classList.add('minimized');
    }
    updateTaskbarItem(window);
  });
  taskbarItems.appendChild(item);
  window.taskbarItem = item;
}

function updateTaskbarItem(window){
  if(window.classList.contains('minimized')){
    window.taskbarItem.style.background = 'linear-gradient(to bottom, #d0d0d0, #c0c0c0)';
  } else {
    window.taskbarItem.style.background = 'linear-gradient(to bottom, #f0f0f0, #e0e0e0)';
  }
}

function removeTaskbarItem(window){
  if(window.taskbarItem){
    window.taskbarItem.remove();
  }
}


function attachIcon(icon){
  let isDragging = false;
  let startX, startY;
  icon.addEventListener('mousedown', function(e){
    isDragging = true;
    startX = e.clientX - icon.offsetLeft;
    startY = e.clientY - icon.offsetTop;
    icon.style.zIndex = ++windowZIndex;
  });
  document.addEventListener('mousemove', function(e){
    if(!isDragging) return;
    let newX = e.clientX - startX;
    let newY = e.clientY - startY;
    icon.style.left = newX + 'px';
    icon.style.top = newY + 'px';
  });
  document.addEventListener('mouseup', function(){
    isDragging = false;
  });
  icon.addEventListener('click', function(e){
    if(!isDragging){
      const app = this.dataset.app;
      createWindow(app);
    }
  });
  icon.addEventListener('contextmenu', function(e){
    e.preventDefault();
    const url = prompt('Enter new icon URL:', this.querySelector('img').src);
    if(url){
      this.querySelector('img').src = url;
    }
  });
}

document.querySelectorAll('.icon').forEach(attachIcon);
document.querySelectorAll('.start-menu-item').forEach(item => {
  item.addEventListener('click', function() {
    const app = this.dataset.app;
    if (app === 'log-off' || app === 'turn-off') {
      alert(`You clicked on ${this.textContent}. This action is not implemented in this simulation.`);
    } else {
      createWindow(app);
    }
    document.querySelector('.start-menu').style.display = 'none';
  });
});

const startButton=document.querySelector('.start-button');const addAppButton=document.querySelector('.add-app-button');
const startMenu=document.querySelector('.start-menu');

startButton.addEventListener('click',function(){
  if(startMenu.style.display === 'block'){
    startMenu.style.display='none';
  }else{
    startMenu.style.display='block';
  }
});

document.addEventListener('click',function(e){
  if(!startButton.contains(e.target) && !startMenu.contains(e.target)){
    startMenu.style.display='none';
  }
});

addAppButton.addEventListener('click',function(){
  const id=prompt('Enter app ID (unique key):');
  if(!id || apps[id]) return;
  const title=prompt('Enter app title:');
  if(!title) return;
  const content=prompt('Enter HTML content for the app:','<div style="padding:20px">New App</div>');
  if(content===null) return;
  const iconUrl=prompt('Enter icon URL:','https://cdn-icons-png.flaticon.com/512/888/888879.png');
  if(iconUrl===null) return;
  apps[id]={title,content};
  const icon=document.createElement('div');
  icon.className='icon';
  icon.dataset.app=id;
  icon.style.top='20px';
  icon.style.left=(20+document.querySelectorAll(".icon").length*80)+'px';
  icon.innerHTML=`<img src="${iconUrl}" alt="${title}"><div class="icon-label">${title}</div>`;
  document.getElementById('desktop').appendChild(icon);
  attachIcon(icon);
});
function updateClock(){
  const now = new Date();
  const israelTime = new Date(now.toLocaleString("en-US", {timeZone: "Asia/Jerusalem"}));
  let h = israelTime.getHours();
  const minutes = israelTime.getMinutes().toString().padStart(2, '0');
  let displayHours = h.toString().padStart(2, '0');
  let suffix = '';
  if(!use24Hour){
    displayHours = ((h % 12) || 12).toString().padStart(2, '0');
    suffix = h >= 12 ? ' PM' : ' AM';
  }
  const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
  const dayName = days[israelTime.getDay()];
  const date = israelTime.getDate().toString().padStart(2, '0');
  const month = (israelTime.getMonth() + 1).toString().padStart(2, '0');
  document.querySelector('.clock').textContent = `${displayHours}:${minutes}${suffix}`;
  document.querySelector('.clock').title = `${dayName}, ${date}/${month}/${israelTime.getFullYear()}`;
}
setInterval(updateClock,1000);
updateClock();

// Calculator functions
let calcMemory = 0;

function calcClick(val){
  const display = document.getElementById('calc-display');
  if(display) display.value += val;
}

function calcEquals(){
  const display = document.getElementById('calc-display');
  if(display){
    try{
      display.value = eval(display.value);
    }catch(e){
      display.value = 'Error';
    }
  }
}

function calcClear(){
  const display = document.getElementById('calc-display');
  if(display) display.value = '';
}

function calcBackspace(){
  const display = document.getElementById('calc-display');
  if(display) display.value = display.value.slice(0, -1);
}

function calcMemoryAdd(){
  const display = document.getElementById('calc-display');
  const memDisplay = document.getElementById('calc-memory');
  if(display && display.value){
    try{
      const val = eval(display.value);
      calcMemory += val;
      if(memDisplay) memDisplay.textContent = calcMemory;
      playClickSound();
    }catch(e){}
  }
}

function calcMemorySub(){
  const display = document.getElementById('calc-display');
  const memDisplay = document.getElementById('calc-memory');
  if(display && display.value){
    try{
      const val = eval(display.value);
      calcMemory -= val;
      if(memDisplay) memDisplay.textContent = calcMemory;
      playClickSound();
    }catch(e){}
  }
}

function calcMemoryRecall(){
  const display = document.getElementById('calc-display');
  if(display){
    display.value = calcMemory;
    playClickSound();
  }
}

function calcMemoryClear(){
  calcMemory = 0;
  const memDisplay = document.getElementById('calc-memory');
  if(memDisplay) memDisplay.textContent = '0';
  playClickSound();
}

// Notepad functions
function saveNotepad(){
  const text = document.querySelector('.notepad-text');
  if(text){
    localStorage.setItem('notepad-content', text.value);
    alert('Saved to browser storage!');
  }
}

function loadNotepad(){
  const text = document.querySelector('.notepad-text');
  if(text){
    const saved = localStorage.getItem('notepad-content');
    if(saved){
      text.value = saved;
      alert('Loaded from storage!');
    }else{
      alert('No saved content found.');
    }
  }
}

function searchNotepad(){
  const text = document.querySelector('.notepad-text');
  const searchInput = document.getElementById('notepad-search');
  if(text && searchInput && searchInput.value){
    const searchTerm = searchInput.value;
    const content = text.value;
    const index = content.toLowerCase().indexOf(searchTerm.toLowerCase());

    if(index !== -1){
      text.focus();
      text.setSelectionRange(index, index + searchTerm.length);
      text.scrollTop = text.scrollHeight * (index / content.length);
      playClickSound();
    }else{
      alert('Text not found: ' + searchTerm);
      playErrorSound();
    }
  }
}

function countWords(){
  const text = document.querySelector('.notepad-text');
  if(text){
    const content = text.value.trim();
    const words = content ? content.split(/\s+/).length : 0;
    const chars = content.length;
    const lines = content ? content.split('\n').length : 0;
    alert(`Words: ${words}\nCharacters: ${chars}\nLines: ${lines}`);
    playClickSound();
  }
}

function updateNotepadStats(){
  const text = document.querySelector('.notepad-text');
  const stats = document.getElementById('notepad-stats');
  if(text && stats){
    const content = text.value.trim();
    const words = content ? content.split(/\s+/).length : 0;
    const chars = text.value.length;
    stats.textContent = `Words: ${words} | Chars: ${chars}`;
  }
}

// Paint functions
let painting = false;
let paintCanvas, paintCtx;
let paintTool = 'brush';
let paintStartX, paintStartY;
let paintSnapshot;

function setPaintTool(tool){
  paintTool = tool;
  // Update button styles
  ['brush', 'rectangle', 'circle', 'eraser'].forEach(t => {
    const btn = document.getElementById('tool-' + t);
    if(btn){
      btn.style.border = t === tool ? '2px inset #999' : '2px outset #999';
      btn.style.background = t === tool ? '#fff' : '';
    }
  });
}

function initPaint(){
  paintCanvas = document.getElementById('paint-canvas');
  if(!paintCanvas) return;
  paintCanvas.width = paintCanvas.offsetWidth;
  paintCanvas.height = paintCanvas.offsetHeight;
  paintCtx = paintCanvas.getContext('2d');
  paintCtx.lineCap = 'round';

  paintCanvas.addEventListener('mousedown', e => {
    painting = true;
    const rect = paintCanvas.getBoundingClientRect();
    paintStartX = e.clientX - rect.left;
    paintStartY = e.clientY - rect.top;

    if(paintTool === 'brush' || paintTool === 'eraser'){
      paintCtx.beginPath();
      paintCtx.moveTo(paintStartX, paintStartY);
    }else{
      // Save canvas state for shape tools
      paintSnapshot = paintCtx.getImageData(0, 0, paintCanvas.width, paintCanvas.height);
    }
  });

  paintCanvas.addEventListener('mousemove', e => {
    if(!painting) return;
    const rect = paintCanvas.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    const color = document.getElementById('paint-color');
    const size = document.getElementById('paint-size');

    if(paintTool === 'brush'){
      paintCtx.strokeStyle = color ? color.value : '#000';
      paintCtx.lineWidth = size ? size.value : 3;
      paintCtx.lineTo(x, y);
      paintCtx.stroke();
    }else if(paintTool === 'eraser'){
      paintCtx.strokeStyle = '#fff';
      paintCtx.lineWidth = size ? parseInt(size.value) * 3 : 9;
      paintCtx.lineTo(x, y);
      paintCtx.stroke();
    }else if(paintTool === 'rectangle'){
      // Restore canvas and draw preview
      paintCtx.putImageData(paintSnapshot, 0, 0);
      paintCtx.strokeStyle = color ? color.value : '#000';
      paintCtx.lineWidth = size ? size.value : 3;
      paintCtx.strokeRect(paintStartX, paintStartY, x - paintStartX, y - paintStartY);
    }else if(paintTool === 'circle'){
      // Restore canvas and draw preview
      paintCtx.putImageData(paintSnapshot, 0, 0);
      paintCtx.strokeStyle = color ? color.value : '#000';
      paintCtx.lineWidth = size ? size.value : 3;
      const radius = Math.sqrt(Math.pow(x - paintStartX, 2) + Math.pow(y - paintStartY, 2));
      paintCtx.beginPath();
      paintCtx.arc(paintStartX, paintStartY, radius, 0, 2 * Math.PI);
      paintCtx.stroke();
    }
  });

  paintCanvas.addEventListener('mouseup', () => painting = false);
  paintCanvas.addEventListener('mouseleave', () => painting = false);
}

function clearCanvas(){
  if(paintCtx && paintCanvas){
    paintCtx.clearRect(0, 0, paintCanvas.width, paintCanvas.height);
  }
}

function fillCanvas(){
  if(paintCtx && paintCanvas){
    const color = document.getElementById('paint-color');
    paintCtx.fillStyle = color ? color.value : '#fff';
    paintCtx.fillRect(0, 0, paintCanvas.width, paintCanvas.height);
  }
}

// Minesweeper functions
let mineGrid = [];
let mineRows = 9;
let mineCols = 9;
let mineCount = 10;
function initMinesweeper(){
  const grid = document.getElementById('minesweeper-grid');
  if(!grid) return;
  grid.innerHTML = '';
  mineGrid = [];

  // Create grid
  for(let i = 0; i < mineRows; i++){
    mineGrid[i] = [];
    for(let j = 0; j < mineCols; j++){
      mineGrid[i][j] = {mine: false, revealed: false, flagged: false, adjacent: 0};
    }
  }

  // Place mines
  let placed = 0;
  while(placed < mineCount){
    const r = Math.floor(Math.random() * mineRows);
    const c = Math.floor(Math.random() * mineCols);
    if(!mineGrid[r][c].mine){
      mineGrid[r][c].mine = true;
      placed++;
    }
  }

  // Calculate adjacent mines
  for(let i = 0; i < mineRows; i++){
    for(let j = 0; j < mineCols; j++){
      if(mineGrid[i][j].mine) continue;
      let count = 0;
      for(let di = -1; di <= 1; di++){
        for(let dj = -1; dj <= 1; dj++){
          const ni = i + di;
          const nj = j + dj;
          if(ni >= 0 && ni < mineRows && nj >= 0 && nj < mineCols && mineGrid[ni][nj].mine){
            count++;
          }
        }
      }
      mineGrid[i][j].adjacent = count;
    }
  }

  // Render grid
  const table = document.createElement('table');
  table.style.borderCollapse = 'collapse';
  for(let i = 0; i < mineRows; i++){
    const tr = document.createElement('tr');
    for(let j = 0; j < mineCols; j++){
      const td = document.createElement('td');
      td.style.width = '25px';
      td.style.height = '25px';
      td.style.border = '1px solid #999';
      td.style.textAlign = 'center';
      td.style.cursor = 'pointer';
      td.style.background = '#c0c0c0';
      td.style.fontWeight = 'bold';
      td.dataset.row = i;
      td.dataset.col = j;
      td.addEventListener('click', () => revealCell(i, j));
      td.addEventListener('contextmenu', e => {
        e.preventDefault();
        toggleFlag(i, j);
      });
      tr.appendChild(td);
    }
    table.appendChild(tr);
  }
  grid.appendChild(table);
}
function revealCell(r, c){
  if(mineGrid[r][c].revealed || mineGrid[r][c].flagged) return;
  mineGrid[r][c].revealed = true;
  const grid = document.getElementById('minesweeper-grid');
  const cell = grid.querySelector(`td[data-row="${r}"][data-col="${c}"]`);
  if(!cell) return;

  if(mineGrid[r][c].mine){
    cell.textContent = 'üí£';
    cell.style.background = '#f00';
    setTimeout(() => {
      alert('Game Over! You hit a mine!');
      initMinesweeper();
    }, 100);
  }else{
    cell.style.background = '#fff';
    if(mineGrid[r][c].adjacent > 0){
      cell.textContent = mineGrid[r][c].adjacent;
      const colors = ['', '#0000ff', '#008000', '#ff0000', '#000080', '#800000', '#008080', '#000', '#808080'];
      cell.style.color = colors[mineGrid[r][c].adjacent];
    }else{
      // Reveal adjacent cells
      for(let di = -1; di <= 1; di++){
        for(let dj = -1; dj <= 1; dj++){
          const ni = r + di;
          const nj = c + dj;
          if(ni >= 0 && ni < mineRows && nj >= 0 && nj < mineCols){
            revealCell(ni, nj);
          }
        }
      }
    }
  }
}
function toggleFlag(r, c){
  if(mineGrid[r][c].revealed) return;
  mineGrid[r][c].flagged = !mineGrid[r][c].flagged;
  const grid = document.getElementById('minesweeper-grid');
  const cell = grid.querySelector(`td[data-row="${r}"][data-col="${c}"]`);
  if(cell){
    cell.textContent = mineGrid[r][c].flagged ? 'üö©' : '';
  }
}

// Media Player function
function loadMedia(){
  const url = document.getElementById('media-url');
  const container = document.getElementById('media-container');
  if(url && container && url.value){
    if(url.value.includes('youtube.com') || url.value.includes('youtu.be')){
      let videoId = '';
      if(url.value.includes('watch?v=')){
        videoId = url.value.split('watch?v=')[1].split('&')[0];
      }else if(url.value.includes('youtu.be/')){
        videoId = url.value.split('youtu.be/')[1].split('?')[0];
      }
      if(videoId){
        container.innerHTML = `<iframe width="100%" height="300" src="https://www.youtube.com/embed/${videoId}" frameborder="0" allowfullscreen></iframe>`;
      }
    }else{
      container.innerHTML = `<video width="100%" height="300" controls><source src="${url.value}">Your browser does not support video.</video>`;
    }
  }
}

// Snake Game functions
let snakeGame = null;
function startSnake(){
  const canvas = document.getElementById('snake-canvas');
  if(!canvas) return;
  const ctx = canvas.getContext('2d');
  const gridSize = 20;
  const tileCount = canvas.width / gridSize;

  if(snakeGame) clearInterval(snakeGame);

  let snake = [{x: 10, y: 10}];
  let food = {x: 15, y: 15};
  let dx = 0, dy = 0;
  let score = 0;
  let paused = false;

  document.getElementById('snake-score').textContent = score;
  const highScore = localStorage.getItem('snake-high') || 0;
  document.getElementById('snake-high').textContent = highScore;

  document.addEventListener('keydown', e => {
    if(e.key === 'ArrowUp' && dy === 0) { dx = 0; dy = -1; }
    if(e.key === 'ArrowDown' && dy === 0) { dx = 0; dy = 1; }
    if(e.key === 'ArrowLeft' && dx === 0) { dx = -1; dy = 0; }
    if(e.key === 'ArrowRight' && dx === 0) { dx = 1; dy = 0; }
  });

  snakeGame = setInterval(() => {
    if(paused) return;

    const head = {x: snake[0].x + dx, y: snake[0].y + dy};

    if(head.x < 0 || head.x >= tileCount || head.y < 0 || head.y >= tileCount || snake.some(s => s.x === head.x && s.y === head.y)){
      clearInterval(snakeGame);
      playErrorSound();
      alert('Game Over! Score: ' + score);
      if(score > highScore) localStorage.setItem('snake-high', score);
      return;
    }

    snake.unshift(head);

    if(head.x === food.x && head.y === food.y){
      score += 10;
      document.getElementById('snake-score').textContent = score;
      playClickSound();
      food = {x: Math.floor(Math.random() * tileCount), y: Math.floor(Math.random() * tileCount)};
    }else{
      snake.pop();
    }

    ctx.fillStyle = '#000';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    ctx.fillStyle = '#0f0';
    snake.forEach(s => ctx.fillRect(s.x * gridSize, s.y * gridSize, gridSize - 2, gridSize - 2));

    ctx.fillStyle = '#f00';
    ctx.fillRect(food.x * gridSize, food.y * gridSize, gridSize - 2, gridSize - 2);
  }, 150);
}
function pauseSnake(){
  if(snakeGame) clearInterval(snakeGame);
}

// Tic-Tac-Toe functions
let tttBoard = ['', '', '', '', '', '', '', '', ''];
let tttPlayer = 'X';
let tttGameOver = false;
function initTicTacToe(){
  tttBoard = ['', '', '', '', '', '', '', '', ''];
  tttPlayer = 'X';
  tttGameOver = false;
  const board = document.getElementById('ttt-board');
  if(!board) return;
  board.innerHTML = '';
  for(let i = 0; i < 9; i++){
    const cell = document.createElement('div');
    cell.style.width = '80px';
    cell.style.height = '80px';
    cell.style.background = '#fff';
    cell.style.border = '2px solid #333';
    cell.style.display = 'flex';
    cell.style.alignItems = 'center';
    cell.style.justifyContent = 'center';
    cell.style.fontSize = '48px';
    cell.style.fontWeight = 'bold';
    cell.style.cursor = 'pointer';
    cell.dataset.index = i;
    cell.addEventListener('click', () => tttMove(i));
    board.appendChild(cell);
  }
  document.getElementById('ttt-player').textContent = tttPlayer;
  document.getElementById('ttt-status').textContent = '';
}
function tttMove(index){
  if(tttGameOver || tttBoard[index]) return;
  tttBoard[index] = tttPlayer;
  const board = document.getElementById('ttt-board');
  const cell = board.children[index];
  cell.textContent = tttPlayer;
  cell.style.color = tttPlayer === 'X' ? '#00f' : '#f00';
  playClickSound();

  if(tttCheckWin()){
    document.getElementById('ttt-status').textContent = `Player ${tttPlayer} wins!`;
    tttGameOver = true;
    return;
  }

  if(tttBoard.every(c => c)){
    document.getElementById('ttt-status').textContent = 'Draw!';
    tttGameOver = true;
    return;
  }

  tttPlayer = tttPlayer === 'X' ? 'O' : 'X';
  document.getElementById('ttt-player').textContent = tttPlayer;
}
function tttCheckWin(){
  const wins = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
  return wins.some(w => tttBoard[w[0]] && tttBoard[w[0]] === tttBoard[w[1]] && tttBoard[w[0]] === tttBoard[w[2]]);
}
function resetTicTacToe(){
  initTicTacToe();
}

// Task Manager functions
function refreshTaskManager(){
  const tbody = document.getElementById('task-tbody');
  if(!tbody) return;
  tbody.innerHTML = '';

  const windows = document.querySelectorAll('.window');
  windows.forEach(win => {
    const title = win.querySelector('.window-header span').textContent;
    const status = win.classList.contains('minimized') ? 'Minimized' : 'Running';
    const row = tbody.insertRow();
    row.innerHTML = `
      <td style="padding:5px;border:1px solid #999;">${title}</td>
      <td style="padding:5px;border:1px solid #999;">${status}</td>
      <td style="padding:5px;border:1px solid #999;">
        <button onclick="this.closest('tr').taskWindow.remove(); refreshTaskManager();" style="padding:2px 8px;">Close</button>
      </td>
    `;
    row.taskWindow = win;
  });
}
function closeAllWindows(){
  if(confirm('Close all windows?')){
    document.querySelectorAll('.window').forEach(w => w.remove());
    refreshTaskManager();
  }
}

// Sticky Notes functions
function saveStickyNote(){
  const text = document.getElementById('sticky-text');
  if(text){
    localStorage.setItem('sticky-note', text.value);
    alert('Note saved!');
  }
}
function loadStickyNote(){
  const text = document.getElementById('sticky-text');
  if(text){
    const saved = localStorage.getItem('sticky-note');
    if(saved) text.value = saved;
  }
}
function clearStickyNote(){
  const text = document.getElementById('sticky-text');
  if(text) text.value = '';
}

// Calendar functions
let calendarDate = new Date();
function initCalendar(){
  updateCalendarDisplay();
}
function updateCalendarDisplay(){
  const monthEl = document.getElementById('calendar-month');
  const gridEl = document.getElementById('calendar-grid');
  if(!monthEl || !gridEl) return;

  const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
  monthEl.textContent = `${months[calendarDate.getMonth()]} ${calendarDate.getFullYear()}`;

  gridEl.innerHTML = '';
  const days = ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa'];
  days.forEach(d => {
    const dayHeader = document.createElement('div');
    dayHeader.textContent = d;
    dayHeader.style.fontWeight = 'bold';
    dayHeader.style.padding = '5px';
    gridEl.appendChild(dayHeader);
  });

  const firstDay = new Date(calendarDate.getFullYear(), calendarDate.getMonth(), 1).getDay();
  const daysInMonth = new Date(calendarDate.getFullYear(), calendarDate.getMonth() + 1, 0).getDate();

  for(let i = 0; i < firstDay; i++){
    gridEl.appendChild(document.createElement('div'));
  }

  const today = new Date();
  for(let day = 1; day <= daysInMonth; day++){
    const dayEl = document.createElement('div');
    dayEl.textContent = day;
    dayEl.style.padding = '5px';
    dayEl.style.textAlign = 'center';
    dayEl.style.cursor = 'pointer';
    dayEl.style.background = '#fff';
    dayEl.style.border = '1px solid #ccc';

    if(day === today.getDate() && calendarDate.getMonth() === today.getMonth() && calendarDate.getFullYear() === today.getFullYear()){
      dayEl.style.background = '#316AC5';
      dayEl.style.color = '#fff';
      dayEl.style.fontWeight = 'bold';
    }

    dayEl.addEventListener('click', () => alert(`Selected: ${months[calendarDate.getMonth()]} ${day}, ${calendarDate.getFullYear()}`));
    gridEl.appendChild(dayEl);
  }
}
function calendarPrevMonth(){
  calendarDate.setMonth(calendarDate.getMonth() - 1);
  updateCalendarDisplay();
}
function calendarNextMonth(){
  calendarDate.setMonth(calendarDate.getMonth() + 1);
  updateCalendarDisplay();
}
function calendarToday(){
  calendarDate = new Date();
  updateCalendarDisplay();
}

// Photo Viewer functions
function loadPhoto(){
  const url = document.getElementById('photo-url');
  const container = document.getElementById('photo-container');
  if(url && container && url.value){
    container.innerHTML = `<img src="${url.value}" style="max-width:100%;max-height:100%;object-fit:contain;" onerror="this.parentElement.innerHTML='<div style=color:#f00>Failed to load image</div>'">`;
  }
}

// Solitaire functions
let solitaireState = {
  deck: [],
  stock: [],
  waste: [],
  foundations: [[],[],[],[]],
  tableau: [[],[],[],[],[],[],[]],
  draggedCard: null,
  draggedFrom: null
};

function initSolitaire(){
  const game = document.getElementById('solitaire-game');
  if(!game) return;

  // Create deck
  const suits = ['‚ô†','‚ô•','‚ô¶','‚ô£'];
  const values = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
  const colors = {'‚ô†':'black','‚ô£':'black','‚ô•':'red','‚ô¶':'red'};

  solitaireState.deck = [];
  for(let suit of suits){
    for(let i = 0; i < values.length; i++){
      solitaireState.deck.push({suit, value: values[i], numValue: i+1, color: colors[suit]});
    }
  }

  // Shuffle deck
  for(let i = solitaireState.deck.length - 1; i > 0; i--){
    const j = Math.floor(Math.random() * (i + 1));
    [solitaireState.deck[i], solitaireState.deck[j]] = [solitaireState.deck[j], solitaireState.deck[i]];
  }

  // Deal cards
  solitaireState.tableau = [[],[],[],[],[],[],[]];
  solitaireState.foundations = [[],[],[],[]];
  solitaireState.waste = [];

  for(let i = 0; i < 7; i++){
    for(let j = i; j < 7; j++){
      const card = solitaireState.deck.pop();
      card.faceUp = (i === j);
      solitaireState.tableau[j].push(card);
    }
  }

  solitaireState.stock = solitaireState.deck;

  renderSolitaire();
}

function renderSolitaire(){
  const game = document.getElementById('solitaire-game');
  if(!game) return;

  let html = '<div style="display:flex;gap:10px;margin-bottom:20px;">';

  // Stock pile
  html += `<div style="width:70px;height:95px;border:2px solid #fff;border-radius:5px;background:${solitaireState.stock.length > 0 ? '#00f' : 'rgba(255,255,255,0.1)'};cursor:pointer;display:flex;align-items:center;justify-content:center;color:#fff;font-size:24px;" onclick="drawCard()">
    ${solitaireState.stock.length > 0 ? 'üÇ†' : ''}
  </div>`;

  // Waste pile
  const wasteCard = solitaireState.waste.length > 0 ? solitaireState.waste[solitaireState.waste.length - 1] : null;
  html += `<div style="width:70px;height:95px;border:2px solid #fff;border-radius:5px;background:${wasteCard ? '#fff' : 'rgba(255,255,255,0.1)'};display:flex;align-items:center;justify-content:center;color:${wasteCard ? wasteCard.color : '#fff'};font-size:18px;font-weight:bold;" ${wasteCard ? `draggable="true" ondragstart="solDragStart('waste', ${solitaireState.waste.length - 1})"` : ''}>
    ${wasteCard ? wasteCard.value + wasteCard.suit : ''}
  </div>`;

  html += '<div style="flex:1;"></div>';

  // Foundation piles
  for(let i = 0; i < 4; i++){
    const topCard = solitaireState.foundations[i].length > 0 ? solitaireState.foundations[i][solitaireState.foundations[i].length - 1] : null;
    html += `<div style="width:70px;height:95px;border:2px solid #fff;border-radius:5px;background:${topCard ? '#fff' : 'rgba(255,255,255,0.2)'};display:flex;align-items:center;justify-content:center;color:${topCard ? topCard.color : '#fff'};font-size:18px;font-weight:bold;" ondrop="solDrop('foundation', ${i})" ondragover="event.preventDefault()">
      ${topCard ? topCard.value + topCard.suit : (i === 0 ? '‚ô†' : i === 1 ? '‚ô•' : i === 2 ? '‚ô¶' : '‚ô£')}
    </div>`;
  }

  html += '</div>';

  // Tableau
  html += '<div style="display:flex;gap:10px;">';
  for(let i = 0; i < 7; i++){
    html += `<div style="width:70px;min-height:95px;border:2px dashed rgba(255,255,255,0.3);border-radius:5px;position:relative;" ondrop="solDrop('tableau', ${i})" ondragover="event.preventDefault()">`;

    for(let j = 0; j < solitaireState.tableau[i].length; j++){
      const card = solitaireState.tableau[i][j];
      const offsetTop = j * 25;
      if(card.faceUp){
        html += `<div style="position:absolute;top:${offsetTop}px;width:66px;height:91px;border:1px solid #000;border-radius:5px;background:#fff;display:flex;align-items:center;justify-content:center;color:${card.color};font-size:18px;font-weight:bold;cursor:move;" draggable="true" ondragstart="solDragStart('tableau', ${i}, ${j})">
          ${card.value}${card.suit}
        </div>`;
      }else{
        html += `<div style="position:absolute;top:${offsetTop}px;width:66px;height:91px;border:1px solid #000;border-radius:5px;background:#00f;cursor:default;" onclick="flipTableauCard(${i})">
          üÇ†
        </div>`;
      }
    }

    html += '</div>';
  }
  html += '</div>';

  game.innerHTML = html;

  checkWin();
}

function drawCard(){
  if(solitaireState.stock.length > 0){
    const card = solitaireState.stock.pop();
    card.faceUp = true;
    solitaireState.waste.push(card);
    playClickSound();
  }else if(solitaireState.waste.length > 0){
    // Reset stock from waste
    solitaireState.stock = solitaireState.waste.reverse();
    solitaireState.waste = [];
    solitaireState.stock.forEach(c => c.faceUp = false);
    playClickSound();
  }
  renderSolitaire();
}

function solDragStart(from, pile, index = -1){
  event.dataTransfer.effectAllowed = 'move';
  solitaireState.draggedFrom = {from, pile, index};
}

function solDrop(to, pile){
  event.preventDefault();
  if(!solitaireState.draggedFrom) return;

  const {from, pile: fromPile, index} = solitaireState.draggedFrom;
  let card, cards = [];

  if(from === 'waste'){
    card = solitaireState.waste[solitaireState.waste.length - 1];
    cards = [card];
  }else if(from === 'tableau'){
    card = solitaireState.tableau[fromPile][index];
    cards = solitaireState.tableau[fromPile].slice(index);
  }

  // Validate move
  let valid = false;

  if(to === 'foundation'){
    if(cards.length === 1){
      const foundation = solitaireState.foundations[pile];
      if(foundation.length === 0){
        valid = card.value === 'A';
      }else{
        const topCard = foundation[foundation.length - 1];
        valid = card.suit === topCard.suit && card.numValue === topCard.numValue + 1;
      }
    }
  }else if(to === 'tableau'){
    const tableau = solitaireState.tableau[pile];
    if(tableau.length === 0){
      valid = card.value === 'K';
    }else{
      const topCard = tableau[tableau.length - 1];
      if(topCard.faceUp){
        valid = card.color !== topCard.color && card.numValue === topCard.numValue - 1;
      }
    }
  }

  if(valid){
    // Move cards
    if(to === 'foundation'){
      solitaireState.foundations[pile].push(card);
    }else{
      solitaireState.tableau[pile].push(...cards);
    }

    // Remove from source
    if(from === 'waste'){
      solitaireState.waste.pop();
    }else if(from === 'tableau'){
      solitaireState.tableau[fromPile].splice(index);
      // Flip top card if needed
      if(solitaireState.tableau[fromPile].length > 0){
        const lastCard = solitaireState.tableau[fromPile][solitaireState.tableau[fromPile].length - 1];
        lastCard.faceUp = true;
      }
    }

    playClickSound();
  }else{
    playErrorSound();
  }

  solitaireState.draggedFrom = null;
  renderSolitaire();
}

function flipTableauCard(pile){
  const tableau = solitaireState.tableau[pile];
  if(tableau.length > 0){
    const topCard = tableau[tableau.length - 1];
    if(!topCard.faceUp){
      topCard.faceUp = true;
      playClickSound();
      renderSolitaire();
    }
  }
}

function checkWin(){
  const totalInFoundations = solitaireState.foundations.reduce((sum, f) => sum + f.length, 0);
  if(totalInFoundations === 52){
    setTimeout(() => {
      alert('üéâ You Win! Congratulations!');
      playClickSound();
    }, 100);
  }
}

// Internet Explorer functions
function ieGo(){
  const urlInput = document.getElementById('ie-url');
  const frame = document.getElementById('ie-frame');
  if(urlInput && frame){
    frame.src = urlInput.value;
    playClickSound();
  }
}

function ieNavigate(direction){
  const frame = document.getElementById('ie-frame');
  if(frame && frame.contentWindow){
    if(direction < 0) frame.contentWindow.history.back();
    else frame.contentWindow.history.forward();
    playClickSound();
  }
}

function ieRefresh(){
  const frame = document.getElementById('ie-frame');
  if(frame){
    frame.src = frame.src;
    playClickSound();
  }
}

function ieHome(){
  const urlInput = document.getElementById('ie-url');
  const frame = document.getElementById('ie-frame');
  if(urlInput && frame){
    urlInput.value = 'https://www.bing.com';
    frame.src = 'https://www.bing.com';
    playClickSound();
  }
}

// Outlook Express functions
function showEmailFolder(folder){
  alert('Opening ' + folder + ' folder...');
  playClickSound();
}

function composeEmail(){
  alert('Compose new email:\n\nTo:\nSubject:\nMessage:\n\n(Demo mode - emails not actually sent)');
  playClickSound();
}

function refreshEmails(){
  alert('Checking for new emails...\n\nNo new messages.');
  playClickSound();
}

// Control Panel functions
function showThemeSettings(){
  const themes = ['blue', 'olive', 'silver', 'luna', 'royale', 'zune'];
  let choice = prompt('Choose a theme:\n1 - Classic Blue\n2 - Olive Green\n3 - Silver\n4 - Luna\n5 - Royale\n6 - Zune\n\nEnter number (1-6):');

  if(choice && choice >= 1 && choice <= 6){
    changeTheme(themes[choice - 1]);
  }
}

function showDisplaySettings(){
  const width = prompt('Enter default window width (200-800):', defaultWindowWidth);
  const height = prompt('Enter default window height (150-600):', defaultWindowHeight);

  if(width && !isNaN(width)){
    defaultWindowWidth = parseInt(width);
    playClickSound();
  }
  if(height && !isNaN(height)){
    defaultWindowHeight = parseInt(height);
    playClickSound();
  }
  savePreferences();
  alert('Display settings updated!');
}

function showSoundSettings(){
  alert('Sound Settings:\n\nüîä System sounds: Enabled\nüéµ Volume: 100%\n\n(Demo mode - actual volume controls not available)');
  playClickSound();
}

function showSystemInfo(){
  const storage = JSON.stringify(localStorage).length;
  const apps = Object.keys(apps).length;
  alert(`System Information:\n\nüíª OS: Windows XP Simulator\nüåê Browser: ${navigator.userAgent.split(' ').pop()}\nüì¶ Apps installed: ${apps}\nüíæ Storage used: ${(storage/1024).toFixed(2)} KB\n‚è∞ Session time: ${new Date().toLocaleTimeString()}`);
  playClickSound();
}

function showStorageSettings(){
  const storage = JSON.stringify(localStorage).length;
  const confirm = window.confirm(`Storage Information:\n\nUsed: ${(storage/1024).toFixed(2)} KB\n\nDo you want to clear all saved data?`);

  if(confirm){
    localStorage.clear();
    alert('All saved data cleared!');
    playClickSound();
  }
}

function showClockSettings(){
  use24Hour = !use24Hour;
  savePreferences();
  updateClock();
  alert(`Clock format changed to ${use24Hour ? '24-hour' : '12-hour'} format`);
  playClickSound();
}

// Save and load preferences
function savePreferences(){
  const prefs = {
    wallpaper: document.getElementById('desktop').style.backgroundImage,
    use24Hour: use24Hour,
    defaultWindowWidth: defaultWindowWidth,
    defaultWindowHeight: defaultWindowHeight
  };
  localStorage.setItem('xp-preferences', JSON.stringify(prefs));
}
function loadPreferences(){
  const saved = localStorage.getItem('xp-preferences');
  if(saved){
    const prefs = JSON.parse(saved);
    if(prefs.wallpaper) document.getElementById('desktop').style.backgroundImage = prefs.wallpaper;
    if(prefs.use24Hour !== undefined) use24Hour = prefs.use24Hour;
    if(prefs.defaultWindowWidth) defaultWindowWidth = prefs.defaultWindowWidth;
    if(prefs.defaultWindowHeight) defaultWindowHeight = prefs.defaultWindowHeight;
  }
  // Load theme
  const theme = localStorage.getItem('xp-theme');
  const themes = {
    'blue': {taskbar: 'linear-gradient(to bottom,#2584ff 0%,#0254cc 100%)'},
    'olive': {taskbar: 'linear-gradient(to bottom,#b4c99c 0%,#99b578 100%)'},
    'silver': {taskbar: 'linear-gradient(to bottom,#c1c9d3 0%,#a5adb8 100%)'},
    'luna': {taskbar: 'linear-gradient(to bottom,#1f4fd3 0%,#0831a8 100%)'},
    'royale': {taskbar: 'linear-gradient(to bottom,#6c8cd5 0%,#2a52be 100%)'},
    'zune': {taskbar: 'linear-gradient(to bottom,#f78d1e 0%,#d87208 100%)'}
  };
  if(theme && themes[theme]){
    document.querySelector('.taskbar').style.background = themes[theme].taskbar;
  }
}

// Change theme function
function changeTheme(themeName){
  const themes = {
    'blue': {taskbar: 'linear-gradient(to bottom,#2584ff 0%,#0254cc 100%)', name: 'Classic Blue'},
    'olive': {taskbar: 'linear-gradient(to bottom,#b4c99c 0%,#99b578 100%)', name: 'Olive Green'},
    'silver': {taskbar: 'linear-gradient(to bottom,#c1c9d3 0%,#a5adb8 100%)', name: 'Silver'},
    'luna': {taskbar: 'linear-gradient(to bottom,#1f4fd3 0%,#0831a8 100%)', name: 'Luna'},
    'royale': {taskbar: 'linear-gradient(to bottom,#6c8cd5 0%,#2a52be 100%)', name: 'Royale'},
    'zune': {taskbar: 'linear-gradient(to bottom,#f78d1e 0%,#d87208 100%)', name: 'Zune'}
  };

  if(themes[themeName]){
    document.querySelector('.taskbar').style.background = themes[themeName].taskbar;
    localStorage.setItem('xp-theme', themeName);
    alert('Theme changed to ' + themes[themeName].name);
    playClickSound();
  }
}

// Screensaver
let screensaverTimeout;
let screensaverActive = false;
function resetScreensaver(){
  clearTimeout(screensaverTimeout);
  if(screensaverActive){
    const ss = document.getElementById('screensaver');
    if(ss) ss.remove();
    screensaverActive = false;
  }
  screensaverTimeout = setTimeout(showScreensaver, 300000); // 5 minutes
}
function showScreensaver(){
  if(screensaverActive) return;
  screensaverActive = true;
  const ss = document.createElement('div');
  ss.id = 'screensaver';
  ss.style.position = 'fixed';
  ss.style.top = '0';
  ss.style.left = '0';
  ss.style.width = '100vw';
  ss.style.height = '100vh';
  ss.style.background = '#000';
  ss.style.zIndex = '100000';
  ss.style.display = 'flex';
  ss.style.alignItems = 'center';
  ss.style.justifyContent = 'center';
  ss.style.color = '#0f0';
  ss.style.fontSize = '48px';
  ss.style.fontFamily = 'Arial';
  ss.innerHTML = '<div style="animation: float 3s ease-in-out infinite;">Windows XP</div><style>@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-20px)}}</style>';
  ss.addEventListener('click', resetScreensaver);
  ss.addEventListener('mousemove', resetScreensaver);
  document.body.appendChild(ss);
}
document.addEventListener('mousemove', resetScreensaver);
document.addEventListener('keydown', resetScreensaver);
document.addEventListener('click', resetScreensaver);
resetScreensaver();

// Simple sound effects using Web Audio API
const audioContext = new (window.AudioContext || window.webkitAudioContext)();
function playSound(frequency, duration, type = 'sine'){
  try{
    const oscillator = audioContext.createOscillator();
    const gainNode = audioContext.createGain();
    oscillator.connect(gainNode);
    gainNode.connect(audioContext.destination);
    oscillator.frequency.value = frequency;
    oscillator.type = type;
    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
    oscillator.start(audioContext.currentTime);
    oscillator.stop(audioContext.currentTime + duration);
  }catch(e){
    // Silently fail if audio not supported
  }
}
function playOpenSound(){
  playSound(800, 0.1);
}
function playCloseSound(){
  playSound(600, 0.1);
}
function playClickSound(){
  playSound(1000, 0.05);
}
function playErrorSound(){
  playSound(200, 0.2, 'square');
}

// Load preferences on start
window.addEventListener('load', () => {
  loadPreferences();
  setTimeout(initPaint, 500);
  setTimeout(initMinesweeper, 500);
});
const APP_VERSION = '1.0.0';
window.addEventListener('DOMContentLoaded', function () {
  const contextMenu = document.getElementById('custom-menu');
  const menuButton = document.getElementById('menu-button');
  const aboutModal = document.getElementById('about-modal');
  const aboutClose = document.getElementById('about-close');
  let previousFocus;
  const focusableSelector = 'a, button, input, textarea, select, [tabindex]:not([tabindex="-1"])';
  let modalFocusables = [];
  function trapFocus(e) {
      if (e.key === "Tab") {
        e.preventDefault();
        const items = modalFocusables;
        if (items.length === 0) {
          return;
        }
        let index = items.indexOf(document.activeElement);
        if (e.shiftKey) {
          index = index <= 0 ? items.length - 1 : index - 1;
        } else {
          index = index === items.length - 1 ? 0 : index + 1;
        }
        items[index].focus();
      } else if (e.key === "Escape") {
        aboutClose.click();
      }
    }
  document.getElementById('about-version').textContent = APP_VERSION;
  document.addEventListener('contextmenu', function (e) {
    e.preventDefault();
    contextMenu.style.left = e.pageX + 'px';
    contextMenu.style.top = e.pageY + 'px';
    contextMenu.style.display = 'block';
  });
  document.addEventListener('click', function (e) {
    if (!contextMenu.contains(e.target) && e.target !== menuButton) {
      contextMenu.style.display = 'none';
    }
  });
  menuButton.addEventListener('click', function () {
    if (draggingMenu) {
      draggingMenu = false;
      return;
    }
    const r = this.getBoundingClientRect();
    contextMenu.style.left = r.left + 'px';
    contextMenu.style.top = r.bottom + 'px';
    contextMenu.style.display = 'block';
  });
  document.getElementById('menu-refresh').addEventListener('click', function () {
    location.reload();
  });
  document.getElementById('menu-top').addEventListener('click', function () {
    contextMenu.classList.toggle('top');
  });
  document.getElementById('menu-size').addEventListener('click', function () {
      const w = prompt('Default window width:', defaultWindowWidth);
      if (w !== null) {
        const h = prompt('Default window height:', defaultWindowHeight);
        if (h !== null) {
          const nw = parseInt(w);
          const nh = parseInt(h);
          if (!isNaN(nw) && nw > 0) defaultWindowWidth = nw;
          if (!isNaN(nh) && nh > 0) defaultWindowHeight = nh;
        }
      }
      contextMenu.style.display = 'none';
    });
  document.getElementById('menu-wallpaper').addEventListener('click', function () {
    const desktop = document.getElementById('desktop');
    const current = getComputedStyle(desktop).backgroundImage;
    const match = current.match(/^url\(["']?(.*?)["']?\)$/i);
    const defaultUrl = match ? match[1] : '';
    const url = prompt('Enter wallpaper URL:', defaultUrl);
    if (url !== null) {
      if (url.trim() === '') {
        desktop.style.backgroundImage = 'none';
      } else {
        const escaped = url.replace(/'/g, "\\'");
        desktop.style.backgroundImage = `url('${escaped}')`;
      }
    }
    contextMenu.style.display = 'none';
  });
  document.getElementById("menu-about").addEventListener("click", function () {
    aboutModal.style.display = "flex";
    contextMenu.style.display = "none";
    previousFocus = document.activeElement;
    modalFocusables = Array.from(aboutModal.querySelectorAll(focusableSelector));
    aboutModal.addEventListener('keydown', trapFocus);
    if (modalFocusables.length > 0) {
      modalFocusables[0].focus();
    }
  });

  aboutClose.addEventListener("click", function () {
    aboutModal.removeEventListener('keydown', trapFocus);
    aboutModal.style.display = "none";
    if (previousFocus) previousFocus.focus();
  });

  window.addEventListener('click', function (e) {
    if (e.target === aboutModal) {
      aboutClose.click();
    }
  });
  document.getElementById('menu-move').addEventListener('click', function () {
    menuButtonMovable = !menuButtonMovable;
    menuButton.style.cursor = menuButtonMovable ? 'move' : 'pointer';
    contextMenu.style.display = 'none';
  });
  document.getElementById('menu-theme').addEventListener('click', function () {
    const choice = prompt('Choose theme:\n1 - Classic Blue\n2 - Olive Green\n3 - Silver\n4 - Luna\n5 - Royale\n6 - Zune', '1');
    const themeMap = {'1': 'blue', '2': 'olive', '3': 'silver', '4': 'luna', '5': 'royale', '6': 'zune'};
    const theme = themeMap[choice];
    if(theme){
      changeTheme(theme);
    }
    contextMenu.style.display = 'none';
  });
  document.getElementById('menu-minimize').addEventListener('click', function () {
    if (activeWindow) {
      activeWindow.classList.add('minimized');
      updateTaskbarItem(activeWindow);
    }
    contextMenu.style.display = 'none';
  });
    document.getElementById('menu-reset').addEventListener('click', function () {
      menuButton.style.left = '';
      menuButton.style.right = '20px';
      menuButton.style.top = '80px';
      contextMenu.style.display = 'none';
    });
    document.getElementById('menu-clock').addEventListener('click', function () {
      use24Hour = !use24Hour;
      updateClock();
      contextMenu.style.display = 'none';
    });
  document.getElementById('menu-close').addEventListener('click', function () {
    if (activeWindow) {
      activeWindow.remove();
      removeTaskbarItem(activeWindow);
    }
    contextMenu.style.display = 'none';
  });
});
</script>
<div id="custom-menu" class="context-menu">
  <ul>
    <li id="menu-refresh">Refresh</li>
    <li id="menu-top">Toggle On Top</li>
    <li id="menu-size">Set Window Size...</li>
    <li id="menu-theme">Change Theme...</li>
    <li id="menu-move">Move Menu Button</li>
    <li id="menu-wallpaper">Change Wallpaper...</li>
    <li id="menu-about">About</li>
    <li id="menu-minimize">Minimize Window</li>
      <li id="menu-reset">Reset Menu Position</li>
      <li id="menu-clock">Toggle Clock Format</li>
    <li id="menu-close">Close Window</li>
  </ul>
</div>
<button id="menu-button" class="open-menu-button">Menu</button>
<div id="about-modal" role="dialog" aria-modal="true" class="about-modal">
  <div class="about-modal-content">
    <span id="about-close" aria-label="Close" class="about-close">&times;</span>
    <h3>Windows XP Simulator</h3>
    <p>Version <span id="about-version"></span></p>
  </div>
</div>
<script>
  let lastMouseX = 0,
    lastMouseY = 0;
  document.addEventListener('mousemove', e => {
    lastMouseX = e.clientX;
    lastMouseY = e.clientY;
  });
  document.addEventListener("keydown", e => {
    if (aboutModal.style.display === "flex") {
      if (e.key === "Escape") {
        aboutClose.click();
      } else if (e.key === "Tab") {
        trapFocus(e);
      }
    } else if (e.key === "ContextMenu") {
      contextMenu.style.left = lastMouseX + "px";
      contextMenu.style.top = lastMouseY + "px";
      contextMenu.style.display = "block";
      e.preventDefault();
    }
  });
  let draggingMenu = false,
    offsetX = 0,
    offsetY = 0,
    menuButtonMovable = true;
  menuButton.addEventListener('mousedown', function (e) {
    if (e.button !== 0 || !menuButtonMovable) return;
    draggingMenu = true;
    const r = menuButton.getBoundingClientRect();
    offsetX = e.clientX - r.left;
    offsetY = e.clientY - r.top;
    menuButton.style.right = 'auto';
  });
  document.addEventListener('mousemove', function (e) {
    if (!draggingMenu) return;
    menuButton.style.left = e.clientX - offsetX + 'px';
    menuButton.style.top = e.clientY - offsetY + 'px';
  });
  document.addEventListener('mouseup', function () {
    draggingMenu = false;
  });
</script>
</body></html>
